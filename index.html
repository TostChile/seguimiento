<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Seguimiento de Pedido</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
    }
    input, select, button {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      margin: 5px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .note {
      font-size: 13px;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>Rastrea tu pedido</h1>
  <p>Ingresa tu número de pedido y selecciona tu región:</p>

  <form onsubmit="buscar(); return false;">
    <input id="codigo" placeholder="Ej: TO-169973" required>
    <select id="region">
      <option value="rm">Región Metropolitana</option>
      <option value="otras">Otras Regiones</option>
    </select>
    <button type="submit">Buscar</button>
  </form>

  <p class="note">Se abrirán nuevas pestañas con el resultado del seguimiento según tu región.</p>

  <!-- Formulario oculto para DispatchTrack -->
  <form id="form-dispatch" action="https://mtransporte.dispatchtrack.com/widget/jhJCY3V19f9Tl3PN_3mRbw" method="POST" target="_blank" style="display: none;">
    <input type="hidden" name="authenticity_token" value="e+mZdEpoOz5sAnNnWJVsAG9BXL0D4KGiUj5Cv5Y7yekqX9Ew1obl0kExGvotO3cJsV96b67hwOUCoUJJR5F0Vw==">
    <input type="hidden" name="search" id="dispatch-search">
  </form>

  <!-- Formulario oculto para SimpliRoute -->
  <form id="form-simpliroute" method="GET" target="_blank" style="display: none;">
    <input type="hidden" id="simpliroute-code">
  </form>

  <script>
    function buscar() {
      const codigo = document.getElementById('codigo').value.trim();
      const region = document.getElementById('region').value;

      if (!codigo) {
        alert('Por favor, ingresa tu número de pedido.');
        return;
      }

      if (region === 'rm') {
        // 1. DispatchTrack por POST
        const codigoDispatch = codigo.replace(/^TO-/, '');
        document.getElementById('dispatch-search').value = codigoDispatch;
        document.getElementById('form-dispatch').submit();

        // 2. SimpliRoute por GET
        const formSR = document.getElementById('form-simpliroute');
        formSR.action = 'https://livetracking.simpliroute.com/widget/account/45260/tracking/' + encodeURIComponent(codigo);
        formSR.submit();

      } else {
        // Solo Alasxpress
        const urlAX = 'https://tracking.alasxpress.com/api/' + encodeURIComponent(codigo);
        window.open(urlAX, '_blank');
      }
    }
  </script>

</body>
</html>
